import { cleanInput } from "../utils"

// part 1
{
  const rawMaze = `....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...`
const maze = cleanInput(rawMaze);
  const dirs = {
    n: [-1, 0],
    e: [0, 1],
    s: [1, 0],
    w: [0, -1],
  }
  const nextDirMap = {
    n: 'e',
    e: 's',
    s: 'w',
    w: 'n'
  }
  const guard = '^'
  const blocker = '#'
  const startDir = 'n'
  const rowStart = maze.findIndex(r => r.includes(guard))
  const start = [rowStart, maze[rowStart].indexOf(guard)]
  let count = [start.join(',')]
  let nextDir = startDir
  let currSpot = start

  while (maze[currSpot[0] + dirs[nextDir][0]]?.[currSpot[1] + dirs[nextDir][1]] !== undefined) {
    const maybeNextSpot = [currSpot[0] + dirs[nextDir][0], currSpot[1] + dirs[nextDir][1]]
    if (maze[maybeNextSpot[0]][maybeNextSpot[1]] !== blocker) {
      currSpot = maybeNextSpot
      count.push(currSpot.join(','))
    } else {
      nextDir = nextDirMap[nextDir]
    }
  }
  count = [...new Set(count)]
  console.log(count.length)
}

// part 2
{
  const rawMaze = `............#.............#......................#....#....................................................#..............#.......
..................................#...#......#.......#........#..................#....#...........................##....#.........
...........#...........#...........#...#...#...............................#.......................##....................#........
..................#.............#........#.....................#...........................................................#......
....#............................................................#..#...#......#.#......#...#..........#..#.....#....#...#........
.................................#......##.............................#..........................#...#.........#.................
.#.............#.........#..#..............................................................................##...........#..#......
....#..............#..........................##......#........#...#........#..........#........#.............#...................
.....#.......#..#......#..#..................................................................#.........................#..........
......................#...............................#......#................................#......#.....#......................
.......#.........#.....................................................................#....#.#.....................#.........#...
........................#......##..........#....#..........................#....................#...................#.........#...
................#..#............#...#.................................................................#...........#...............
.#.....#.....................#..........................................#................................#........................
.............#.##........#......#......#......................#..................................................#...#..........#.
.......#.........#.#..........#.............#.......#............#.....................#..........................................
.............................#.........................................................#.........#.........#.............#........
....#..#.#..................................................#...........#..................#....#.................................
...............#..........#.....#..............................................................#..................................
.......##.............................................................................#...............#.........#.................
....#.....#..........................#..........#................................#....................#...#.......................
.#.................................................#..#.....#.....................................................................
...........................#..............#.#...#..........................................#......#..........................#....
.#....#........#....................................................#...........................................#.................
...#..................#................##...#.............#..#....................#...............#...............................
..................................................#......#..........................................................#...#.........
#.#....................................#........#.............................................................#...................
...............................................#.......##...............................................#.........................
...#.............#................................................................................................................
.......................................#....#..#........#............#..........#.........#...#..................#................
........#.................................................#.........................................#...........#.................
...................#...........#...............................#..........................#................#..#..........#.....#..
...............#......#...............................................................#............................##..#.....##...
.........................................##.#..#..................#.......#.....................#.................................
...........#...................................................................#...#..................................#.....#.....
......#...............................#.......###..........................#....#.....................................#...........
.....##...............................#...................................................#................................#...#..
..................#....#.......#.......................................................................##.........................
.....#..#.................................................................................................#.......................
.#.................................#......................##....................................#..........................##.....
#.#................#......................................#...........................#.......#...................................
.................................#.......#.....#..............................................##..#....................#..........
............#...............................................................................#....#...........#..........#.........
................................................##...............................................#..#..........................#..
.................#.......#........................................................................#...............................
..#.........................#......#.............#.......................................#........................................
...............#.............#...........................................................#.....#..................................
.........#...............................................................................#...............................#........
.........................................#...................#.................#.........##........#.........#....................
............#..........#.....#................................................................#...##............................#.
........#...#....#..............................................#..............#........................#.........................
..#.....................................................................................................................#.........
.#....#.............................^................#..#...................#.........................#...........................
..........................................................................#.........#....#......#.................................
.........#................................#.#........................#.................#...................................#......
.............................................#.##............................................................#......#..#.........#
..........#............#...........#..#......#..........#.........................................................................
......................#....................................#....#.............##....#.............................................
......................#...#............#.......................................................................................#..
.##.................#.......................#...............#.............#......#..................................#.....#.#.....
....................#........#.......................#....................................#.......#...#.......#.......#......#....
.............................................................#.......................#..........................#.....#...........
...#.................#.......................................................#.......##...........#.......#.......................
...............##.........................#.........................................................#.....#.......#...............
.......................#.......................#.........#..............#....................#..........#........................#
...................................##..........#..........................................................#.........#.............
..................#...............................#...................................#.......#.......................#...........
.......................#..#...................................#........................#........#............#....................
...................................#....#............#..................#........................................#..........#.....
.............#...#...#......#.............##...............................................#..........................#....#......
....................#..........................................#....#......................................................#......
............#.........#...............#..#.....................................................................#.#................
.......................#..#..............................................................#.....#........#..#..................#...
.............#..#..............................#.....#.................#.............#.......................#................#...
...............#......#...........#............#.........#......................................#.................................
............................#.....#.........#.....#..#...........#................................................................
....#.......#.................#..............................................#.......#.#.............................#...#..#.....
..................................................#.#......#............................................................#.........
..................................#............#........................#.......#.........#...#...............#...................
............##....#.#......#..............................................................................#..............#........
.....#..........................................#.........................................................#........##.............
............#.....................#..#.#..............#........#......#.............................#....#...#....................
.......................#...........................................................................#..............................
......#.........................................#........#............#..#..............................#.#.......................
#.#......#..#...............#...........#....#.................................................#..................................
.........#...........#............................#..............#......................#.......................................#.
...#............#..................................#..............#............................#.........................#........
...##..#.....................................................................................#...........................#........
...............#......#.........#................................#...#............#....................#..........................
..........................#...........................#..............................................#................#....#......
.........#........#.#...........................................................................#..#..............................
.................#..............#........................................................................#.................#......
...#.........#.#.........#.#...........................................#........#........#.........#..............................
..........#............................................................#..........#.....#.........................................
..................................#.....#...........##........#......#..........#..........................#......................
...........................#....#.............#............................................................#......................
.............#.......#...................................#.....#............................................................##....
............#..............##.............#.....#...............#..........#........................#.........................#...
..##.....................................................................................................#........................
.............#.#...........#...................#....#...#......#................##................................................
.................#.#............#........................#.......##..#.........##.................................................
......................#.#...#................................................................#...............#.....#...........#..
#.................#..........................#.............................##.....#...........................................#...
..............#.........#.................#................................................................................#......
....#.#............#.......#.......................#.....#.......................#....................#.....#.............#.......
......................#..#....#.........................................#.#............##............#............................
.........#.#...#...#........................................#...............................................#....................#
.......................#...................#.............................................................#.......................#
................#............................#........#..........#.......................##....#..................................
.#...................#......................#.......................................#............................#................
..#..##.......#......#..........#..#..................................................#...........................................
..............#..........#...........................................#.........##.................................................
....#..............................#.........#...#.................#......#.#.......#.............................................
#.................................#........#.....................................#...##...................#..#...........#........
.......#.....#.............................................#..................#...................#...........#..#........#.......
.......................#................#.............#.#.........#..............................................................#
......................................................#....................#..........#................................#..........
#...............#...#.............#.................#.................................................#...........................
..................................................................#.........................#......#.........#............##......
#.................#........#.......#...#....................................#.#...................................................
.....................................#...#....#.........#................#.........................................#...#..........
............#............................#.............#.#........................................................................
......................................#.................................................#...............#.......#.................
.#.#..........#........#.......................#..................................................#....................#..........
....#...............................................................#...........#............#.......................#............
....#.......#.#..#...................#.........#..................................#....................................#..........
..............................................#...................................##.......#......................................
#...#.#............#...............................#.........#...........#..........#............................................#
..#...........#..#..........#.......................#..........##.................................................................
...#.....#..................................#................................................#....................................`
const maze = cleanInput(rawMaze);
  const dirs = {
    n: [-1, 0],
    e: [0, 1],
    s: [1, 0],
    w: [0, -1],
  }
  const nextDirMap = {
    n: 'e',
    e: 's',
    s: 'w',
    w: 'n'
  }
  const guard = '^'
  const blocker = '#'
  const editBlocker = `@`
  const startDir = 'n'
  const rowStart = maze.findIndex(r => r.includes(guard))
  const start = [rowStart, maze[rowStart].indexOf(guard)]
  let path = []
  let nextDir = startDir
  let currSpot = start
  let blockerSpots = []
  // same as pt1
  while (maze[currSpot[0] + dirs[nextDir][0]]?.[currSpot[1] + dirs[nextDir][1]] !== undefined) {
    const maybeNextSpot = [currSpot[0] + dirs[nextDir][0], currSpot[1] + dirs[nextDir][1]]
    if (maze[maybeNextSpot[0]][maybeNextSpot[1]] !== blocker) {
      currSpot = maybeNextSpot
      path.push(currSpot.join(',') + `,${nextDir}`)
    } else {
      nextDir = nextDirMap[nextDir]
    }
  }

  // check if a block in path would lead to a loop
  path.forEach((point, indy) => {
    let nextDir = startDir
    let currSpot = start
    let currPath = [start.join(',') + `,${nextDir}`]
    const [y, x] = point.split(',').map(Number)
    const modMaze = maze.map((el, i) => y === i ? `${el.slice(0, x)}${editBlocker}${el.slice(x+1)}` : el)
    while (modMaze[currSpot[0] + dirs[nextDir][0]]?.[currSpot[1] + dirs[nextDir][1]] !== undefined) {
      const maybeNextSpot = [currSpot[0] + dirs[nextDir][0], currSpot[1] + dirs[nextDir][1]]
      if (![blocker, editBlocker].includes(modMaze[maybeNextSpot[0]][maybeNextSpot[1]])) {
        currSpot = maybeNextSpot
        // loop detected
        if (currPath.includes(`${maybeNextSpot.join(',')},${nextDir}`)){
          blockerSpots.push([y,x].join(','))
          break;
        }
        currPath.push(currSpot.join(',') + `,${nextDir}`)
      } else {
        nextDir = nextDirMap[nextDir]
      }
    }
  })
  blockerSpots = [...new Set(blockerSpots)]
  console.log(blockerSpots.length)
}